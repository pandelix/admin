(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-03cb0402"],{"0cc4":function(e,t,n){},1028:function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("a-popover",e._b({attrs:{trigger:"click",visible:e.visible},on:{visibleChange:e.onVisibleChange},scopedSlots:e._u([{key:"content",fn:function(){return[n("div",{staticClass:"mb-2"},[e.title?n("span",[e._v(e._s(e.title))]):e._t("title")],2),n("space",{staticClass:"actions"},[n("a-button",{attrs:{size:"small"},on:{click:e.onCancel}},[e._v(e._s(e.cancelText))]),n("loading-action",{attrs:{action:e.onConfirm,size:"small",type:"primary"}},[e._v(" "+e._s(e.okText)+" ")])],1)]},proxy:!0}])},"a-popover",e.$attrs,!1),[e._t("default",null,{pop:this})],2)},i=[],r=(n("96cf"),n("1da1")),o=n("36bd"),s=n("5a99"),c={name:"LzPopconfirm",components:{LoadingAction:s["a"],Space:o["a"]},data:function(){return{visible:!1}},props:{title:{type:String,default:"确认操作？"},cancelText:{type:String,default:"取消"},okText:{type:String,default:"确认"},confirm:Function,disabled:Boolean},methods:{onCancel:function(){this.visible=!1,this.$emit("cancel")},onConfirm:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(t.t0=e.confirm,!t.t0){t.next=4;break}return t.next=4,e.confirm();case 4:e.$emit("confirm"),e.visible=!1;case 6:case"end":return t.stop()}}),t)})))()},onVisibleChange:function(e){this.disabled||(this.visible=e)}}},u=c,l=(n("26ac"),n("2877")),d=Object(l["a"])(u,a,i,!1,null,"85c03b24",null);t["a"]=d.exports},"142e":function(e,t,n){},"195f":function(e,t,n){},2627:function(e,t,n){},"26ac":function(e,t,n){"use strict";var a=n("195f"),i=n.n(a);i.a},2847:function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"resize",rawName:"v-resize",value:e.setImgSize,expression:"setImgSize"}],staticClass:"file-preview flex-box"},[e.path?e.isImage?n("img",{staticClass:"img",attrs:{alt:e.path,title:e.path,src:e.url}}):n("div",{staticClass:"path",attrs:{title:e.path}},[e._v(e._s(e.path))]):n("div",{staticClass:"invalid",attrs:{title:e.path}},[e._v(" 无效 ")]),n("div",{staticClass:"actions flex-box"},[n("space",{attrs:{size:"4"}},[e.disableView?e._e():[e.isImage?n("a-icon",{attrs:{type:"eye",title:"查看"},on:{click:function(t){return t.stopPropagation(),e.onPreview(t)}}}):n("a",{attrs:{href:e.url,target:"_blank",title:"查看"}},[n("a-icon",{attrs:{type:"eye"}})],1)],e._t("default",null,{file:e.formattedFile})],2)],1)])},i=[],r=n("53ca"),o=n("5530"),s=n("a6d5"),c=n("2f62"),u=n("90fe"),l=n("f2af"),d=n("36bd"),p={name:"FilePreview",components:{Space:d["a"]},data:function(){return{formattedFile:{path:"",url:""},width:0,height:0}},props:Object(o["a"])({file:null,disableView:Boolean},Object(c["c"])(["miniWidth"])),computed:{isImage:function(){return Object(s["b"])(this.formattedFile.path)},url:function(){return this.formattedFile.url},path:function(){return this.formattedFile.path}},methods:{toUpperCase:function(e){return e.toUpperCase()},formatFile:function(){var e=this.file;e&&("string"===typeof e?this.formattedFile={path:e,url:Object(u["i"])(e)}:"object"===Object(r["a"])(e)&&(this.formattedFile=Object.assign({},e,{path:e.path||"",url:e.url||Object(u["i"])(e.path)})))},onPreview:function(){var e=this;this.$createElement;this.isImage&&(this.setImgSize(),l["a"].new({propsData:{wrapClassName:"image-preview-dialog",width:"auto",content:function(t){return t("img",{attrs:{src:e.formattedFile.url,width:e.width,height:e.height}})}}}))},setImgSize:function(){if(this.isImage){var e=Math.min(1e3,.9*window.innerWidth),t=.9*window.innerHeight,n=this.$el.querySelector(".img");this.width=n.naturalWidth||1,this.height=n.naturalHeight||1;var a=this.width/this.height;this.width>e&&(this.width=e,this.height=this.width/a),this.height>t&&(this.height=t,this.width=this.height*a)}}},watch:{file:{handler:function(){this.formatFile()},immediate:!0}}},h=p,f=(n("42d2"),n("7900"),n("2877")),g=Object(f["a"])(h,a,i,!1,null,"44603ec1",null);t["a"]=g.exports},"2eaa":function(e,t,n){var a=n("d612"),i=n("8db3"),r=n("5edf"),o=n("7948"),s=n("b047f"),c=n("c584"),u=200;function l(e,t,n,l){var d=-1,p=i,h=!0,f=e.length,g=[],m=t.length;if(!f)return g;n&&(t=o(t,s(n))),l?(p=r,h=!1):t.length>=u&&(p=c,h=!1,t=new a(t));e:while(++d<f){var v=e[d],b=null==n?v:n(v);if(v=l||0!==v?v:0,h&&b===b){var x=m;while(x--)if(t[x]===b)continue e;g.push(v)}else p(t,b,l)||g.push(v)}return g}e.exports=l},"33c7":function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("div",{staticClass:"content-header"},[n("span",{staticClass:"title"},[e._v(e._s(e.realName))]),n("div",{staticClass:"flex-spacer"}),n("div",[e._t("actions")],2)]),n("div",{class:{center:e.center}},[e._t("default")],2)])},i=[],r=n("5530"),o=n("2f62"),s=n("4416"),c=n.n(s),u={name:"PageContent",props:{title:String,center:Boolean},computed:Object(r["a"])({},Object(o["c"])({matchedMenusChain:function(e){return e.matchedMenusChain}}),{realName:function(){var e,t;if(this.title)return this.title;var n="";return this.matchedMenusChain.length&&(n=c()(this.matchedMenusChain).title),n||(null===(e=this.$route)||void 0===e||null===(t=e.meta)||void 0===t?void 0:t.title)||""}})},l=u,d=(n("e4b2"),n("2877")),p=Object(d["a"])(l,a,i,!1,null,"81c7aafa",null);t["a"]=p.exports},"42d2":function(e,t,n){"use strict";var a=n("142e"),i=n.n(a);i.a},"53ca":function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));n("a4d3"),n("e01a"),n("d28b"),n("e260"),n("d3b7"),n("3ca3"),n("ddb0");function a(e){return a="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}},7061:function(e,t,n){"use strict";var a=n("c3fe"),i=n.n(a);i.a},7900:function(e,t,n){"use strict";var a=n("d418"),i=n.n(a);i.a},"8a59":function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"system-media",class:{"mini-width":e.miniWidth,"tiny-width":e.tinyWidth}},[e.miniWidth?e._e():n("div",{staticClass:"sider"},[n("category",{ref:"category",staticClass:"h-100",on:{select:e.onCategorySelect,"categories-change":e.onCategoriesChange}})],1),n("div",{staticClass:"content"},[n("div",{staticClass:"header"},[n("space",[e.miniWidth?n("a-button",{on:{click:function(t){e.categoriesDialog=!0}}},[e._v("选择分类")]):e._e(),n("loading-action",{attrs:{action:e.onReloadMedia}},[e._v("刷新")]),n("a-button",{attrs:{disabled:!e.anySelected},on:{click:function(t){e.movingDialog=!0}}},[e._v("移动")]),void 0===e.defaultMultiple?n("a-button",{attrs:{type:e.multiple?"primary":""},on:{click:function(t){e.multiple=!e.multiple}}},[e._v(" 多选 ")]):e._e(),n("lz-popconfirm",{attrs:{title:"物理文件也有可能会被删除！确认删除？",type:"danger",disabled:!e.anySelected,confirm:e.onDestroyMedia}},[n("a-button",{attrs:{type:"danger",disabled:!e.anySelected}},[e._v("删除")])],1)],1)],1),n("a-spin",{staticClass:"files",class:{"files-empty":0===e.media.length},attrs:{spinning:e.mediaLoading||e.uploading,tip:e.uploadingText}},[n("files",{ref:"media",attrs:{media:e.media,multiple:e.multiple,selected:e.selected,ext:e.defaultExt},on:{"update:selected":function(t){e.selected=t}}}),n("a-empty",{directives:[{name:"show",rawName:"v-show",value:0===e.media.length&&!e.mediaLoading,expression:"media.length === 0 && !mediaLoading"}]})],1),n("div",{staticClass:"footer"},[n("space",[n("a-upload",{ref:"upload",attrs:{"custom-request":e.storeMedia,"before-upload":e.beforeUpload,"show-upload-list":!1,disabled:e.currentCategoryId<=0,multiple:"",accept:"."+(e.defaultExt?e.defaultExt:"").replace(/,/g,",.")},on:{change:e.onUploadChange}},[n("a-button",{attrs:{disabled:e.currentCategoryId<=0,title:e.currentCategoryId<=0?"请先选择分类":""}},[e._v(" 上传 ")])],1),n("a-button",{attrs:{disabled:!e.anySelected},on:{click:e.clearSelected}},[e._v(" 清空 "+e._s(this.selectedCount?"("+this.selectedCount+")":"")+" ")]),n("a-button",{attrs:{disabled:!!e.defaultExt,title:e.ext,type:e.ext?"primary":null},on:{click:e.onOpenExtDialog}},[e._v(" "+e._s(e.ext?"已筛选":"筛选")+" ")]),e._t("actions",null,null,e.getThis)],2),n("div",{staticClass:"flex-spacer"}),n("lz-pagination",{staticStyle:{height:"auto"},attrs:{page:e.page,"auto-push":!1,"show-quick-jumper":!1,"show-size-changer":!1,"hide-on-single-page":"",simple:""},on:{"current-change":e.onPageChange}})],1)],1),e.defaultExt?e._e():n("a-modal",{attrs:{title:"筛选类型",width:"400px"},on:{ok:e.onExtFilter},model:{value:e.extDialog,callback:function(t){e.extDialog=t},expression:"extDialog"}},[n("a-input",{attrs:{focus:"","allow-clear":""},on:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onExtFilter(t)}},model:{value:e.extTemp,callback:function(t){e.extTemp=t},expression:"extTemp"}})],1),n("a-modal",{attrs:{title:"移动文件",width:"400px"},scopedSlots:e._u([{key:"footer",fn:function(){return[n("a-button",{on:{click:function(t){e.movingDialog=!1}}},[e._v("取消")]),n("loading-action",{attrs:{type:"primary",action:e.onMove,disabled:!e.movingTarget}},[e._v(" 移动 ")])]},proxy:!0}]),model:{value:e.movingDialog,callback:function(t){e.movingDialog=t},expression:"movingDialog"}},[n("a-select",{staticClass:"w-100",attrs:{"show-search":"","option-filter-prop":"title","option-label-prop":"title"},model:{value:e.movingTarget,callback:function(t){e.movingTarget=t},expression:"movingTarget"}},e._l(e.categoriesSelectOptions,(function(t){return n("a-select-option",{key:t.id,attrs:{title:t.title}},[e._v(" "+e._s(t.text)+" ")])})),1)],1),e.miniWidth?n("a-modal",{attrs:{title:"选择分类",footer:null},model:{value:e.categoriesDialog,callback:function(t){e.categoriesDialog=t},expression:"categoriesDialog"}},[n("category",{ref:"category",staticClass:"h-100",on:{select:e.onCategorySelect,"categories-change":e.onCategoriesChange}})],1):e._e()],1)},i=[],r=(n("99af"),n("c975"),n("d81d"),n("b0c0"),n("ac1f"),n("1276"),n("96cf"),n("1da1")),o=n("1028"),s=n("28de");function c(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s["b"].get("system-media-categories",{params:e})}function u(e){return s["b"].delete("system-media-categories/".concat(e))}function l(e,t){return s["b"].put("system-media-categories/".concat(e),t)}function d(e){return s["b"].post("system-media-categories",e)}function p(e,t){var n=new FormData;return n.append("file",t),s["b"].post("system-media-categories/".concat(e,"/system-media"),n)}function h(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s["b"].get("system-media-categories/".concat(e,"/system-media"),{params:t})}function f(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s["b"].get("system-media",{params:e})}function g(e){return s["b"].put("system-media",e)}function m(e){return s["b"].post("system-media",{_method:"DELETE",id:e})}var v=n("9b02"),b=n.n(v),x=n("d613"),y=n("90fe"),w=n("a125"),C=n.n(w),_=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"category"},[n("a-input",{staticClass:"filter-input mb-1",class:{"w-100":e.miniWidth},attrs:{placeholder:"搜索分类"},model:{value:e.q,callback:function(t){e.q=t},expression:"q"}}),n("a-button-group",{staticClass:"category-actions mb-2",class:{"w-100":e.miniWidth}},[n("loading-action",{attrs:{action:e.getCategories,"disable-text-when-loading":""}},[e._v("刷新")]),n("a-button",{on:{click:function(t){return e.onOpenDialog(!1)}}},[e._v("添加")]),n("a-button",{attrs:{disabled:e.currentId<=0},on:{click:function(t){return e.onOpenDialog(!0)}}},[e._v("编辑")]),n("lz-popconfirm",{attrs:{disabled:e.currentId<=0,"overlay-style":{width:"200px"},confirm:e.onDestroyCategory,title:"所有子孙分类也将被删除!分类下的文件会被移动到“无分类”下。确认删除？"}},[n("a-button",{attrs:{type:"danger",disabled:e.currentId<=0}},[e._v("删除")])],1)],1),n("a-spin",{staticClass:"categories",attrs:{spinning:e.loading}},[this.categories.length?n("a-tree",{attrs:{"tree-data":e.categories,"replace-fields":e.treeOptions,"default-expand-all":"","selected-keys":[e.currentId],"block-node":"",draggable:"","expanded-keys":e.expandedKeys,"auto-expand-parent":e.autoExpandParent,"filter-tree-node":e.onFilter},on:{select:e.onSelect,drop:e.onDrop,expand:e.onExpand}}):e._e()],1),n("a-modal",{attrs:{title:e.editMode?"编辑分类":"添加分类",footer:null,width:"400px"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[n("lz-form",{attrs:{"disable-redirect":"",form:e.form,errors:e.errors,submit:e.onSave,"in-dialog":"",layout:"vertical","enter-to-submit":"","edit-mode":e.editMode},on:{"update:form":function(t){e.form=t},"update:errors":function(t){e.errors=t}}},[n("lz-form-item",{attrs:{label:"父级",prop:"parent_id"}},[n("a-select",{attrs:{"show-search":"","option-filter-prop":"title","option-label-prop":"title"},model:{value:e.form.parent_id,callback:function(t){e.$set(e.form,"parent_id",t)},expression:"form.parent_id"}},e._l(e.cateOptions,(function(t){return n("a-select-option",{key:t.id,attrs:{title:t.title}},[e._v(" "+e._s(t.text)+" ")])})),1)],1),n("lz-form-item",{attrs:{label:"名称",required:"",prop:"name"}},[n("a-input",{attrs:{focus:""},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),n("lz-form-item",{attrs:{label:"文件夹",prop:"folder"}},[n("a-input",{model:{value:e.form.folder,callback:function(t){e.$set(e.form,"folder",t)},expression:"form.folder"}})],1)],1)],1)],1)},k=[],S=(n("4de4"),n("4160"),n("fb6a"),n("45fc"),n("159b"),n("2909")),O=n("5a99"),j=n("04bc"),E=n("d99d"),I=function e(t,n){for(var a,i=0;i<n.length;i++){var r=n[i];r.children&&(r.children.some((function(e){return e.id===t}))?a=r.id:e(t,r.children)&&(a=e(t,r.children)))}return a},z={name:"Category",components:{LzPopconfirm:o["a"],LoadingAction:O["a"],LzForm:j["a"],LzFormItem:E["a"]},data:function(){return{treeOptions:{children:"children",title:"name",key:"id"},q:"",expandedKeys:[],autoExpandParent:!0,categories:[],loading:!1,current:null,editMode:!1,dialog:!1,form:{parent_id:0,name:"",folder:""},errors:{}}},computed:{currentId:function(){return b()(this.current,"id",-1)},miniWidth:function(){return this.$store.state.miniWidth},canSave:function(){return!this.editMode||this.currentId>0},cateOptions:function(){return Object(y["o"])(this.categories.slice(2),{title:"name"})},flattenCategories:function(){var e=[],t=function t(n){n.forEach((function(n){e.push({id:n.id,name:n.name}),t(n.children||[])}))};return t(this.categories),e}},created:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getCategories();case 2:e.initSelected();case 3:case"end":return t.stop()}}),t)})))()},methods:{getCategories:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var n,a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.prev=1,t.next=4,c();case 4:n=t.sent,a=n.data,e.categories=[{id:-1,name:"所有"},{id:0,name:"无分类"}].concat(Object(S["a"])(a));case 7:return t.prev=7,e.loading=!1,t.finish(7);case 10:case"end":return t.stop()}}),t,null,[[1,,7,10]])})))()},initSelected:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$nextTick();case 2:e.current=e.categories[0];case 3:case"end":return t.stop()}}),t)})))()},onOpenDialog:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.editMode=e,this.canSave&&(this.form={parent_id:e?this.current.parent_id:this.currentId<0?0:this.currentId,name:e?this.current.name:"",folder:e?this.current.folder:""},this.dialog=!0)},onDestroyCategory:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.currentId,!(n<=0)){t.next=3;break}return t.abrupt("return");case 3:return t.next=5,u(n);case 5:e.$message.success(Object(y["h"])("destroyed")),e.initSelected(),Object(y["q"])(e.categories,n);case 8:case"end":return t.stop()}}),t)})))()},onSelect:function(e,t){e.length&&(this.current=t.node.dataRef)},updateCategory:function(e,t){var n=arguments,a=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var r,o;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return r=!(n.length>2&&void 0!==n[2])||n[2],i.next=3,l(e.id,t).setConfig({showValidationMsg:r,validationForm:r?null:a});case 3:o=i.sent,e.name=o.data.name,e.parent_id=o.data.parent_id;case 6:case"end":return i.stop()}}),i)})))()},onSave:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.canSave){n.next=2;break}return n.abrupt("return");case 2:if(!t.editMode){n.next=7;break}return n.next=5,t.updateCategory(t.current,t.form,!1);case 5:n.next=9;break;case 7:return n.next=9,d(t.form).setConfig({validationForm:t});case 9:e.stay?e.onReset():t.dialog=!1,t.getCategories();case 11:case"end":return n.stop()}}),n)})))()},onDrop:function(e){var t=e.dragNode,n=e.node,a=e.dropToGap,i=t.dataRef,r=n.dataRef;i.id<=0||r.id<=0||i.parent_id===r.parent_id&&a||(i.parent_id!==r.id||a)&&this.dropped(i,r,a)},dropped:function(e,t,n){var a=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var r;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return r=0,r=n?t.parent_id:t.id,i.next=4,a.updateCategory(e,{parent_id:r},!0);case 4:a.getCategories();case 5:case"end":return i.stop()}}),i)})))()},onFilter:function(e){return this.q&&e.title.indexOf(this.q)>-1},onExpand:function(e){this.expandedKeys=e,this.autoExpandParent=!1},setExpandedKeys:function(){var e=this;this.expandedKeys=this.flattenCategories.map((function(t){return t.name.indexOf(e.q)>-1?I(t.id,e.categories):null})).filter((function(e,t,n){return e&&n.indexOf(e)===t})),this.autoExpandParent=!0}},watch:{q:{handler:function(){this.setExpandedKeys()},immediate:!0},flattenCategories:function(){this.setExpandedKeys()},current:{handler:function(e){this.$emit("select",e)},immediate:!0},categories:{handler:function(e){this.$emit("categories-change",e.slice(2))},deep:!0},dialog:function(e){e||(this.errors={},this.form={parent_id:0,name:""})}}},M=z,R=(n("ccb2"),n("2877")),$=Object(R["a"])(M,_,k,!1,null,"90f5a328",null),D=$.exports,P=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"file-wrapper"},e._l(e.media,(function(t,a){return n("file-preview",{key:t.id,class:{selected:e.isSelected(t)},attrs:{file:t},nativeOn:{click:function(n){return e.onSelect(t,a)}}})})),1)},F=[],T=(n("a434"),n("5530")),L=n("51f5"),W=n.n(L),q=n("e572"),U=n("a6d5"),B=n("2847"),A={name:"Files",components:{FilePreview:B["a"]},props:{media:Array,multiple:Boolean,selected:Array,ext:String},computed:Object(T["a"])({},Object(q["f"])(["IMAGE_EXTS"])),methods:{onSelect:function(e,t){if(!this.ext||-1!==this.ext.split(",").indexOf(e.ext?e.ext.toLowerCase():"")){var n=this.findInSelected(e);-1!==n?this.selected.splice(n,1):this.multiple?this.selected.push(e):this.$emit("update:selected",[e]),this.$emit("select",this.selected,e,t,-1===n)}},findInSelected:function(e){return W()(this.selected,(function(t){return t.id===e.id}))},isSelected:function(e){return-1!==this.findInSelected(e)},isImage:U["b"],toUpperCase:function(e){return e.toUpperCase()}},watch:{multiple:function(e){e||this.selected.splice(1)}}},K=A,V=(n("7061"),Object(R["a"])(K,P,F,!1,null,"a6210b52",null)),N=V.exports,J=n("36bd"),G={name:"SystemMedia",components:{Space:J["a"],Files:N,Category:D,LzPagination:x["a"],LzPopconfirm:o["a"],LoadingAction:O["a"]},data:function(){return{categories:[],currentCategory:null,media:[],mediaLoading:!1,page:null,ext:this.defaultExt||"",extTemp:"",extDialog:!1,selected:[],movingDialog:!1,moving:!1,movingTarget:"",uploading:!1,uploadCount:0,uploadFail:0,uploadSuccess:0,uploadInvalid:0,multiple:void 0!==this.defaultMultiple&&this.defaultMultiple,categoriesDialog:!1}},props:{defaultExt:{type:String,default:""},defaultMultiple:{type:Boolean,default:void 0}},computed:{currentCategoryId:function(){return b()(this.currentCategory,"id",-1)},miniWidth:function(){return this.$store.state.miniWidth},tinyWidth:function(){return this.$store.state.tinyWidth},anySelected:function(){return this.selectedCount>0},selectedCount:function(){return this.selected.length},categoriesSelectOptions:function(){return Object(y["o"])(this.categories,{title:"name",firstLevel:null})},uploadingText:function(){return this.uploading?"正在上传中 (".concat(this.uploadSuccess," / ").concat(this.uploadCount,")"):""},getThis:function(){return this},extArray:function(){return this.ext.split(",")}},created:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getMedia();case 2:case"end":return t.stop()}}),t)})))()},methods:{getMedia:function(){var e=arguments,t=this;return Object(r["a"])(regeneratorRuntime.mark((function n(){var a,i,r,o,s,c;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=e.length>0&&void 0!==e[0]?e[0]:-1,i=e.length>1?e[1]:void 0,t.mediaLoading=!0,o={page:i,ext:t.ext||void 0},n.prev=4,!(a>0)){n.next=12;break}return n.next=8,h(a,o);case 8:s=n.sent,r=s.data,n.next=17;break;case 12:return o.category_id=-1===a?void 0:0,n.next=15,f(o);case 15:c=n.sent,r=c.data;case 17:if(t.currentCategoryId===a){n.next=19;break}return n.abrupt("return");case 19:t.media=r.data,t.page=r.meta;case 21:return n.prev=21,t.mediaLoading=!1,n.finish(21);case 24:case"end":return n.stop()}}),n,null,[[4,,21,24]])})))()},onPageChange:function(e){this.getMedia(this.currentCategoryId,e)},onReloadMedia:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.getMedia(e.currentCategoryId);case 2:case"end":return t.stop()}}),t)})))()},onExtFilter:function(){this.defaultExt||(this.ext=this.extTemp,this.extDialog=!1)},clearSelected:function(){this.selected=[]},onMove:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.movingTarget&&e.selectedCount){t.next=2;break}return t.abrupt("return");case 2:if(e.movingTarget!==e.currentCategoryId){t.next=6;break}return e.$message.info("没有移动到其他分类"),e.movingDialog=!1,t.abrupt("return");case 6:return t.next=8,e.batchUpdateMedia({id:e.selected.map((function(e){return e.id})),category_id:e.movingTarget});case 8:case"end":return t.stop()}}),t)})))()},batchUpdateMedia:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,g(e).setConfig({showValidationMsg:!0});case 2:t.movingDialog=!1,t.$message.success(Object(y["h"])("updated")),-1===t.currentCategoryId?t.clearSelected():t.moveSelected();case 5:case"end":return n.stop()}}),n)})))()},moveSelected:function(){this.media=C()(this.media,this.selected,"id"),this.clearSelected(),0===this.media.length&&this.onReloadMedia()},onDestroyMedia:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.selectedCount){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,m(e.selected.map((function(e){return e.id})));case 4:e.$message.success(Object(y["h"])("destroyed")),e.moveSelected();case 6:case"end":return t.stop()}}),t)})))()},onCategorySelect:function(e){this.currentCategory=e},onCategoriesChange:function(e){this.categories=e},storeMedia:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function n(){var a,i,r,o,s;return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=e.file,i=e.onSuccess,r=e.onError,o=t.currentCategoryId,!(o<=0)){n.next=4;break}return n.abrupt("return");case 4:return n.prev=4,n.next=7,p(o,a).setConfig({showValidationMsg:!0});case 7:s=n.sent,i(s,null),o!==t.currentCategoryId&&-1!==t.currentCategoryId||t.media.unshift(s.data),n.next=15;break;case 12:n.prev=12,n.t0=n["catch"](4),r(n.t0,s);case 15:case"end":return n.stop()}}),n,null,[[4,12]])})))()},onUploadChange:function(e){var t=e.file;"done"===t.status?this.uploadSuccess++:"error"===t.status&&this.uploadFail++,this.uploadCount&&this.uploadSuccess+this.uploadFail===this.uploadCount&&(this.$info({title:"上传完成",content:"上传成功 (".concat(this.uploadSuccess,")，失败 (").concat(this.uploadFail,")，无效 (").concat(this.uploadInvalid,")")}),this.$refs.upload.sFileList=[],this.uploading=!1,this.uploadCount=0,this.uploadFail=0,this.uploadSuccess=0)},beforeUpload:function(e){var t=e.size/1024/1024<=10;t||Object(y["e"])("文件 不能大于 10240 KB");var n=!this.defaultExt||-1!==this.extArray.indexOf(Object(y["f"])(e.name));n||Object(y["e"])("文件类型只能是："+this.defaultExt);var a=t&&n;return a?(this.uploadCount++,this.uploading=!0):this.uploadInvalid++,a},onOpenExtDialog:function(){this.defaultExt||(this.extDialog=!0)}},watch:{currentCategoryId:function(e){this.clearSelected(),this.getMedia(e)},extDialog:function(e){e&&(this.extTemp=this.ext)},ext:function(e){this.clearSelected(),this.getMedia(this.currentCategoryId)},miniWidth:function(e){e||(this.categoriesDialog=!1)},defaultMultiple:function(e){this.multiple=e}}},H=G,Q=(n("b4e1"),Object(R["a"])(H,a,i,!1,null,"e78ef92c",null));t["a"]=Q.exports},a125:function(e,t,n){var a=n("2eaa"),i=n("5c69"),r=n("badf"),o=n("100e"),s=n("dcbe"),c=n("4416"),u=o((function(e,t){var n=c(t);return s(n)&&(n=void 0),s(e)?a(e,i(t,1,s,!0),r(n,2)):[]}));e.exports=u},a1e3:function(e,t,n){},adeb:function(e,t,n){},b3f7:function(e,t,n){"use strict";var a=n("adeb"),i=n.n(a);i.a},b4e1:function(e,t,n){"use strict";var a=n("2627"),i=n.n(a);i.a},c3fe:function(e,t,n){},ccb2:function(e,t,n){"use strict";var a=n("a1e3"),i=n.n(a);i.a},d418:function(e,t,n){},d613:function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.page?n("a-pagination",e._b({ref:"page",staticClass:"my-1 pagination",attrs:{"page-size-options":e.pageSizes,total:e.page.total,"show-size-changer":e.showSizeChanger,"show-quick-jumper":e.showQuickJumper,"show-total":function(e){return"共 "+e+" 条"},"page-size":e.perPage},on:{"update:pageSize":function(t){e.perPage=t},"update:page-size":function(t){e.perPage=t},change:e.onChange,showSizeChange:e.onSizeChange},model:{value:e.currentPage,callback:function(t){e.currentPage=t},expression:"currentPage"}},"a-pagination",e.$attrs,!1)):e._e()},i=[],r=(n("99af"),n("c975"),n("d3b7"),n("25f0"),{name:"LzPagination",data:function(){return{currentPage:1,perPage:15}},props:{page:Object,autoPush:{type:Boolean,default:!0},showSizeChanger:{type:Boolean,default:!0},showQuickJumper:{type:Boolean,default:!0}},computed:{pageSizes:function(){var e=["15","30","50","100","200"],t=this.page.per_page.toString();return-1===e.indexOf(t)?[t].concat(e):e}},methods:{push:function(e){var t=e.page,n=e.perPage,a=Object.assign({},this.$route.query,{page:t||this.currentPage,per_page:n||this.perPage});this.$router.push({path:this.$route.path,query:a})},onSizeChange:function(e,t){this.$emit("size-change",t),this.autoPush&&(this.currentPage=1,this.push({page:1,perPage:t}))},onChange:function(e){this.$emit("current-change",e),this.autoPush&&this.push({page:e})}},watch:{page:{handler:function(e){e&&(this.currentPage=e.current_page,this.perPage=e.per_page)},immediate:!0}}}),o=r,s=(n("b3f7"),n("2877")),c=Object(s["a"])(o,a,i,!1,null,"2bc5b5e1",null);t["a"]=c.exports},e4b2:function(e,t,n){"use strict";var a=n("0cc4"),i=n.n(a);i.a}}]);
//# sourceMappingURL=chunk-03cb0402.8d70a0fd.js.map